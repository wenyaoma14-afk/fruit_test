<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Fruit Tap</title>
  <style>
    :root{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
      --card: rgba(255,255,255,.88);
      --shadow: 0 18px 45px rgba(0,0,0,.15);
      --r: 22px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      background: radial-gradient(1100px 700px at 20% 15%, #ffef9a 0%, rgba(255,239,154,0) 55%),
                  radial-gradient(1000px 700px at 85% 10%, #a9f2ff 0%, rgba(169,242,255,0) 55%),
                  radial-gradient(900px 700px at 20% 85%, #ffc1f0 0%, rgba(255,193,240,0) 55%),
                  linear-gradient(135deg, #7c3aed 0%, #2563eb 35%, #22c55e 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    .shell{
      width:min(560px, 100%);
      position:relative;
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
      color:#fff;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.35);
      display:grid;place-items:center;
      box-shadow: 0 12px 24px rgba(0,0,0,.18);
      backdrop-filter: blur(8px);
      font-size:22px;
    }
    .title{
      font-weight:900;
      font-size:18px;
      line-height:1.1;
    }
    .subtitle{
      opacity:.9;
      font-size:12px;
      margin-top:2px;
    }
    .score{
      background: rgba(255,255,255,.2);
      border:1px solid rgba(255,255,255,.35);
      border-radius:999px;
      padding:8px 12px;
      font-weight:900;
      backdrop-filter: blur(8px);
      box-shadow: 0 12px 24px rgba(0,0,0,.15);
    }

    .card{
      background: var(--card);
      border:1px solid rgba(255,255,255,.65);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .topbar{
      padding:14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .promptPill{
      display:flex;
      align-items:center;
      gap:10px;
      background: rgba(0,0,0,.06);
      border-radius: 999px;
      padding:10px 12px;
      flex:1;
      min-width: 0;
    }
    .promptIcon{
      width:36px;height:36px;border-radius:14px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.85);
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      font-size:18px;
    }
    .promptText{
      font-weight:900;
      font-size:16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hint{
      font-size:11px;
      opacity:.75;
      margin-top:2px;
    }
    .promptWrap{min-width:0;}

    /* å›¾æ ‡æŒ‰é’®ï¼šå°æœ‹å‹ä¸è¯†å­— */
    .actions{
      display:flex;
      gap:10px;
    }
    .iconBtn{
      width:52px;height:52px;
      border:0;
      border-radius:18px;
      background: rgba(255,255,255,.92);
      box-shadow: 0 12px 22px rgba(0,0,0,.12);
      cursor:pointer;
      display:grid;place-items:center;
      font-size:22px;
      user-select:none;
    }
    .iconBtn:active{ transform: scale(.98); }
    .iconBtn[disabled]{ opacity:.6; cursor:not-allowed; }

    .grid{
      padding: 0 14px 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .tile{
      border:0;
      border-radius: 22px;
      background: rgba(255,255,255,.95);
      box-shadow: 0 14px 26px rgba(0,0,0,.12);
      min-height: 140px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
      user-select:none;
      transition: transform .08s ease;
    }
    .tile:active{ transform: scale(.98); }
    .tile img{
      width:92px;height:92px;
      object-fit:contain;
      pointer-events:none;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.12));
    }
    .tile.correct{ outline: 4px solid #22c55e; }
    .tile.wrong{ outline: 4px solid #ef4444; }

    /* æˆåŠŸï¼šåœ¨æ°´æœç•Œé¢ä¸Šå±‚å¼¹å‡º */
    .overlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(3px);
      z-index: 10;
    }
    .popup{
      width:min(360px, 86%);
      background: rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius: 26px;
      box-shadow: 0 28px 60px rgba(0,0,0,.25);
      padding: 18px 18px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .good{
      font-size: 46px;
      font-weight: 1000;
      letter-spacing: 2px;
      color: #111;
    }
    .bunny{
      font-size: 74px;
      margin: 6px 0 2px;
      animation: dance 620ms ease-in-out infinite;
      transform-origin: 50% 80%;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.18));
    }
    @keyframes dance{
      0%{ transform: translateY(8px) rotate(-7deg) scale(1.0); }
      25%{ transform: translateY(-10px) rotate(7deg) scale(1.06); }
      50%{ transform: translateY(8px) rotate(-7deg) scale(1.0); }
      75%{ transform: translateY(-10px) rotate(7deg) scale(1.06); }
      100%{ transform: translateY(8px) rotate(-7deg) scale(1.0); }
    }

    /* å½©çº¸ */
    .confetti{
      position:absolute;
      width:12px;height:12px;border-radius:4px;
      opacity:0;
      animation: fly 900ms ease-out forwards;
    }
    @keyframes fly{
      0%{ transform:translate(var(--x0), 30px) scale(.7) rotate(0deg); opacity:0; }
      25%{ opacity:1; }
      100%{ transform:translate(var(--x1), -170px) scale(1.1) rotate(180deg); opacity:0; }
    }

    /* é”™è¯¯ï¼šè½»å¾®æŠ–åŠ¨ */
    .shake{ animation: shake 420ms ease-in-out; }
    @keyframes shake{
      0%,100%{ transform: translateX(0); }
      25%{ transform: translateX(-8px); }
      50%{ transform: translateX(8px); }
      75%{ transform: translateX(-6px); }
    }

    .footerTip{
      padding: 0 14px 14px;
      font-size: 11px;
      opacity: .65;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="header">
      <div class="brand">
        <div class="logo">ğŸ“</div>
        <div>
          <div class="title">Fruit Tap</div>
          <div class="subtitle">å¬è‹±æ–‡ â†’ ç‚¹å›¾ç‰‡</div>
        </div>
      </div>
      <div class="score">â­ <span id="score">0</span></div>
    </div>

    <div class="card" id="card">
      <div class="topbar">
        <div class="promptPill">
          <div class="promptIcon">ğŸ”Š</div>
          <div class="promptWrap">
            <div class="promptText" id="promptText">Tap â–¶ï¸ to start</div>
            <div class="hint">ç¬¬ä¸€æ¬¡éœ€è¦ç‚¹ â–¶ï¸ è§£é”è¯­éŸ³ï¼ˆiOS 18.5ï¼‰</div>
          </div>
        </div>

        <div class="actions">
          <!-- å›¾æ ‡æŒ‰é’®ï¼šå¼€å§‹ / å†è¯» / æ¢é¢˜ -->
          <button class="iconBtn" id="startBtn" aria-label="start">â–¶ï¸</button>
          <button class="iconBtn" id="repeatBtn" aria-label="repeat">ğŸ”</button>
          <button class="iconBtn" id="nextBtn" aria-label="next">ğŸ²</button>
        </div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="footerTip">æç¤ºï¼šå®å®ä¸éœ€è¦çœ‹å­—ï¼Œåªè¦å¬è‹±æ–‡ç‚¹å›¾ç‰‡ã€‚</div>

      <!-- âœ… æˆåŠŸå¼¹å‡ºå±‚ -->
      <div class="overlay" id="overlay">
        <div class="popup" id="popup">
          <div class="good">GOOD</div>
          <div class="bunny">ğŸ°</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // âœ… 10ä¸ªæ°´æœï¼ˆä½ å·²ç»ä¸Šä¼ çœŸå®å›¾ç‰‡çš„è¯ï¼Œç”¨ img/xxx.pngï¼›å¦åˆ™å…ˆç”¨ emoji ä¹Ÿèƒ½è·‘ï¼‰
  // å¦‚æœä½ å·²åšâ€œä¼˜åŒ–1â€çš„å›¾ç‰‡ä¸Šä¼ ï¼Œå°±ä¿æŒ img/xxx.png
  const BANK = [
    { en:"apple",      pic:"img/apple.png",      fallback:"ğŸ" },
    { en:"banana",     pic:"img/banana.png",     fallback:"ğŸŒ" },
    { en:"orange",     pic:"img/orange.png",     fallback:"ğŸŠ" },
    { en:"grape",      pic:"img/grape.png",      fallback:"ğŸ‡" },
    { en:"strawberry", pic:"img/strawberry.png", fallback:"ğŸ“" },
    { en:"watermelon", pic:"img/watermelon.png", fallback:"ğŸ‰" },
    { en:"pear",       pic:"img/pear.png",       fallback:"ğŸ" },
    { en:"peach",      pic:"img/peach.png",      fallback:"ğŸ‘" },
    { en:"mango",      pic:"img/mango.png",      fallback:"ğŸ¥­" },
    { en:"pineapple",  pic:"img/pineapple.png",  fallback:"ğŸ" },
  ];

  let score = 0;
  let current = null;
  let locked = false;
  let voiceUnlocked = false;
  let chosenVoice = null;

  const scoreEl = document.getElementById("score");
  const promptTextEl = document.getElementById("promptText");
  const gridEl = document.getElementById("grid");
  const overlay = document.getElementById("overlay");
  const popup = document.getElementById("popup");
  const card = document.getElementById("card");

  const startBtn = document.getElementById("startBtn");
  const repeatBtn = document.getElementById("repeatBtn");
  const nextBtn = document.getElementById("nextBtn");

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // âœ… è®©è‹±æ–‡â€œæ›´å‡†ç¡®â€çš„å…³é”®ï¼šé€‰é«˜è´¨é‡ voice
  function pickBestEnglishVoice() {
    if (!("speechSynthesis" in window)) return null;
    const voices = window.speechSynthesis.getVoices() || [];
    if (!voices.length) return null;

    // åªè¦è‹±æ–‡
    const en = voices.filter(v => /^en(-|_)?/i.test(v.lang));

    // ä¼˜å…ˆ iOS é«˜è´¨é‡ï¼šSiri / Premium / Enhanced
    const prefer = (arr, re) => arr.find(v => re.test((v.name||"") + " " + (v.voiceURI||"")));

    return (
      prefer(en, /siri/i) ||
      prefer(en, /premium|enhanced/i) ||
      en.find(v => v.lang === "en-US") ||
      en[0] ||
      null
    );
  }

  function speakEN(text) {
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();

    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.90;   // æ…¢ä¸€ç‚¹æ›´æ¸…æ™°
    u.pitch = 1.00;

    // é€‰æ‹© voiceï¼ˆç¬¬ä¸€æ¬¡ä¼šåœ¨ voices loaded åç¼“å­˜ï¼‰
    if (!chosenVoice) chosenVoice = pickBestEnglishVoice();
    if (chosenVoice) u.voice = chosenVoice;

    window.speechSynthesis.speak(u);
  }

  function clearConfetti() {
    [...popup.querySelectorAll(".confetti")].forEach(x => x.remove());
  }

  function popConfetti() {
    clearConfetti();
    const colors = ["#22c55e","#3b82f6","#f59e0b","#ef4444","#a855f7","#14b8a6"];
    for (let i=0;i<18;i++){
      const s = document.createElement("div");
      s.className = "confetti";
      s.style.background = colors[i % colors.length];
      s.style.left = (50 + (Math.random()*40 - 20)) + "%";
      s.style.bottom = "8px";
      s.style.setProperty("--x0", (Math.random()*120 - 60).toFixed(1) + "px");
      s.style.setProperty("--x1", (Math.random()*240 - 120).toFixed(1) + "px");
      popup.appendChild(s);
    }
  }

  function hideOverlay() {
    overlay.style.display = "none";
    clearConfetti();
  }

  function showGoodOverlay() {
    popConfetti();
    overlay.style.display = "flex";
    // 0.9s åè‡ªåŠ¨æ¶ˆå¤±ï¼Œç®€å•ç›´æ¥
    setTimeout(hideOverlay, 900);
  }

  function renderQuestion(){
    locked = false;
    hideOverlay();
    card.classList.remove("shake");

    current = BANK[Math.floor(Math.random() * BANK.length)];
    promptTextEl.textContent = current.en; // âœ… ä¸ç»™å®å®çœ‹ä¹Ÿæ²¡å…³ç³»ï¼Œå®¶é•¿çœ‹å¾—æ‡‚

    // 3å¹²æ‰° + 1æ­£ç¡®
    const others = BANK.filter(x => x.en !== current.en);
    shuffle(others);
    const options = [current, ...others.slice(0, 3)];
    shuffle(options);

    gridEl.innerHTML = "";
    options.forEach(item => {
      const btn = document.createElement("button");
      btn.className = "tile";
      btn.setAttribute("aria-label", item.en);

      // ä¼˜å…ˆåŠ è½½çœŸå®å›¾ç‰‡ï¼Œå¤±è´¥åˆ™ç”¨ emoji å…œåº•
      btn.innerHTML = `
        <img src="${item.pic}" alt="${item.en}" onerror="this.replaceWith(Object.assign(document.createElement('div'),{style:'font-size:78px;line-height:1;',textContent:'${item.fallback}'}))">
      `;
      btn.onclick = () => onPick(btn, item);
      gridEl.appendChild(btn);
    });

    if (voiceUnlocked) speakEN(current.en);
  }

  function onPick(btn, item){
    if (locked) return;
    locked = true;

    const buttons = [...document.querySelectorAll(".tile")];
    buttons.forEach(b => b.disabled = true);

    if (item.en === current.en){
      btn.classList.add("correct");
      score += 1;
      scoreEl.textContent = String(score);

      // âœ… æˆåŠŸï¼šç›´æ¥åœ¨ä¸Šå±‚å¼¹ GOOD + å…”å­
      showGoodOverlay();

      // âœ… æˆåŠŸè¯­éŸ³ï¼šåªè¯»ä¸€ä¸ªâ€œGoodâ€
      if (voiceUnlocked) speakEN("Good");

      setTimeout(() => renderQuestion(), 950);
    } else {
      btn.classList.add("wrong");
      card.classList.add("shake");
      if (voiceUnlocked) speakEN("Try again");

      setTimeout(() => {
        card.classList.remove("shake");
        buttons.forEach(b => { b.disabled = false; b.classList.remove("wrong","correct"); });
        locked = false;
      }, 700);
    }
  }

  // iOSï¼šå¿…é¡»ç”¨æˆ·æ‰‹åŠ¿è§¦å‘ä¸€æ¬¡
  startBtn.addEventListener("click", () => {
    voiceUnlocked = true;
    window.speechSynthesis.getVoices(); // è§¦å‘åŠ è½½
    chosenVoice = pickBestEnglishVoice();
    speakEN("Start");
    renderQuestion();
  });

  repeatBtn.addEventListener("click", () => {
    voiceUnlocked = true;
    if (current) speakEN(current.en);
  });

  nextBtn.addEventListener("click", () => {
    renderQuestion();
  });

  // voices å¼‚æ­¥åŠ è½½ï¼šiOS/Chrome éƒ½å¯èƒ½
  if ("speechSynthesis" in window) {
    window.speechSynthesis.onvoiceschanged = () => {
      chosenVoice = pickBestEnglishVoice();
    };
  }

  // ç‚¹å‡»é®ç½©å¯æå‰å…³é—­ï¼ˆå®å®ç‚¹åˆ°ä¹Ÿæ²¡å…³ç³»ï¼‰
  overlay.addEventListener("click", hideOverlay);
</script>
</body>
</html>
