<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Fruit Tap</title>
  <style>
    :root{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#0b1020;
      overflow:hidden;
    }

    /* --- æ°´æœèƒŒæ™¯ï¼šç”¨ emoji æ‹¼æˆâ€œå¾ˆå¤šæ°´æœâ€çš„å›¾æ¡ˆï¼ˆä¸ä¾èµ–å¤–éƒ¨å›¾ç‰‡ï¼‰ --- */
    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.24), transparent 60%),
        radial-gradient(1000px 700px at 85% 15%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(900px 700px at 30% 85%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, #7c3aed 0%, #2563eb 35%, #22c55e 100%);
      z-index:-2;
    }
    .fruitPattern{
      position:fixed; inset:-40px;
      opacity:.18;
      z-index:-1;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='280'%3E%3Crect width='280' height='280' fill='none'/%3E%3Cg font-size='44'%3E%3Ctext x='12' y='58'%3E%F0%9F%8D%8E%3C/text%3E%3Ctext x='120' y='80'%3E%F0%9F%8D%93%3C/text%3E%3Ctext x='210' y='62'%3E%F0%9F%8D%8A%3C/text%3E%3Ctext x='40' y='150'%3E%F0%9F%8D%8C%3C/text%3E%3Ctext x='140' y='160'%3E%F0%9F%8D%89%3C/text%3E%3Ctext x='210' y='170'%3E%F0%9F%8D%87%3C/text%3E%3Ctext x='20' y='250'%3E%F0%9F%8D%8D%3C/text%3E%3Ctext x='120' y='250'%3E%F0%9F%A5%AD%3C/text%3E%3Ctext x='220' y='250'%3E%F0%9F%8D%90%3C/text%3E%3C/g%3E%3C/svg%3E");
      background-repeat: repeat;
      background-size: 280px 280px;
      transform: rotate(-8deg);
    }

    .app{
      width:min(560px, 92vw);
      height:min(820px, 92vh);
      position:relative;
      border-radius:28px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* ---------- å± 1ï¼šå¯åŠ¨é¡µ ---------- */
    .screen{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .home{
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* è¶…å¤§åŠ¨ç”»å¼€å§‹æŒ‰é’® */
    .bigStart{
      width:min(280px, 72vw);
      height:min(280px, 72vw);
      border-radius: 999px;
      border:0;
      cursor:pointer;
      background: rgba(255,255,255,.26);
      backdrop-filter: blur(10px);
      box-shadow: 0 28px 70px rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      position:relative;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transform: translateZ(0);
      animation: floaty 1.8s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-10px); }
    }
    .bigStart::before{
      content:"";
      position:absolute; inset:14px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(255,255,255,.15) 55%, rgba(255,255,255,.08) 70%);
    }
    .bigStart::after{
      content:"";
      position:absolute; inset:-10px;
      border-radius:999px;
      border: 2px solid rgba(255,255,255,.35);
      animation: pulse 1.2s ease-in-out infinite;
    }
    @keyframes pulse{
      0%{ transform: scale(.98); opacity:.55; }
      70%{ transform: scale(1.05); opacity:.0; }
      100%{ transform: scale(1.05); opacity:0; }
    }
    .startIcon{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .bunny{
      font-size: 86px;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.25));
      animation: bunnyDance 600ms ease-in-out infinite;
      transform-origin: 50% 80%;
    }
    @keyframes bunnyDance{
      0%{ transform: translateY(8px) rotate(-6deg) scale(1.0); }
      25%{ transform: translateY(-10px) rotate(6deg) scale(1.06); }
      50%{ transform: translateY(8px) rotate(-6deg) scale(1.0); }
      75%{ transform: translateY(-10px) rotate(6deg) scale(1.06); }
      100%{ transform: translateY(8px) rotate(-6deg) scale(1.0); }
    }
    .play{
      font-size: 56px;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.25));
    }

    /* ---------- å± 2ï¼šæ¸¸æˆé¡µï¼ˆç®€åŒ–ï¼‰ ---------- */
    .game{
      display:none;
      padding: 16px;
      gap: 14px;
      flex-direction:column;
      align-items:stretch;
      justify-content:flex-start;
    }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:14px;
      padding-top: 6px;
    }
    .iconBtn{
      width:72px;
      height:72px;
      border-radius: 22px;
      border:0;
      cursor:pointer;
      background: rgba(255,255,255,.28);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,.22);
      display:grid;
      place-items:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-size: 30px;
    }
    .iconBtn:active{ transform: scale(.98); }

    /* 4 å¼ å›¾ï¼šæ— è¾¹æ¡†ï¼ˆä¸ç”»æ¡†ï¼‰ */
    .grid{
      margin-top: 8px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      flex:1;
      align-content:start;
    }
    .tile{
      border:0;
      background: transparent;
      padding: 0;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      min-height: 170px; /* å›ºå®šé«˜åº¦é¿å…é—ªçƒè·³åŠ¨ */
    }
    .tile:active{ transform: scale(.99); }
    .tile img{
      width: 86%;
      height: auto;
      max-height: 220px;
      object-fit: contain;
      pointer-events:none;
      filter: drop-shadow(0 20px 26px rgba(0,0,0,.25));
    }

    /* æˆåŠŸå¼¹å±‚ï¼šä¸Šå±‚å¼¹å‡º GOODï¼ˆç®€å•ï¼‰ */
    .overlay{
      position:absolute; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.16);
      backdrop-filter: blur(3px);
    }
    .goodPop{
      width:min(320px, 80%);
      border-radius: 28px;
      background: rgba(255,255,255,.88);
      box-shadow: 0 30px 70px rgba(0,0,0,.35);
      padding: 18px 14px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .goodWord{
      font-weight:1000;
      font-size: 52px;
      letter-spacing:2px;
      color:#111;
      margin-top: 6px;
    }
    .popBunny{
      font-size: 76px;
      margin-top: 6px;
      animation: bunnyDance 600ms ease-in-out infinite;
      transform-origin: 50% 80%;
    }

    /* å½©çº¸ */
    .confetti{
      position:absolute;
      width:12px;height:12px;border-radius:4px;
      opacity:0;
      animation: fly 900ms ease-out forwards;
    }
    @keyframes fly{
      0%{ transform:translate(var(--x0), 30px) scale(.7) rotate(0deg); opacity:0; }
      25%{ opacity:1; }
      100%{ transform:translate(var(--x1), -170px) scale(1.1) rotate(180deg); opacity:0; }
    }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="fruitPattern"></div>

  <div class="app">
    <!-- å± 1ï¼šå¯åŠ¨é¡µ -->
    <div class="screen home" id="homeScreen">
      <button class="bigStart" id="homeStart" aria-label="start">
        <div class="startIcon">
          <div class="bunny">ğŸ°</div>
          <div class="play">â–¶ï¸</div>
        </div>
      </button>
    </div>

    <!-- å± 2ï¼šæ¸¸æˆé¡µ -->
    <div class="screen game" id="gameScreen">
      <div class="topRow">
        <button class="iconBtn" id="btnStart" aria-label="start">â–¶ï¸</button>
        <button class="iconBtn" id="btnRepeat" aria-label="repeat">ğŸ”</button>
      </div>
      <div class="grid" id="grid"></div>
    </div>

    <!-- æˆåŠŸå¼¹å±‚ -->
    <div class="overlay" id="overlay">
      <div class="goodPop" id="goodPop">
        <div class="goodWord">GOOD</div>
        <div class="popBunny">ğŸ°</div>
      </div>
    </div>
  </div>

<script>
  // 10 ä¸ªæ°´æœå›¾ç‰‡ï¼ˆè¦æ±‚ï¼šæ”¾åœ¨ img/ ä¸‹ï¼‰
  const BANK = [
    { en:"apple",      pic:"img/apple.png" },
    { en:"banana",     pic:"img/banana.png" },
    { en:"orange",     pic:"img/orange.png" },
    { en:"grape",      pic:"img/grape.png" },
    { en:"strawberry", pic:"img/strawberry.png" },
    { en:"watermelon", pic:"img/watermelon.png" },
    { en:"pear",       pic:"img/pear.png" },
    { en:"peach",      pic:"img/peach.png" },
    { en:"mango",      pic:"img/mango.png" },
    { en:"pineapple",  pic:"img/pineapple.png" },
  ];

  const homeScreen = document.getElementById("homeScreen");
  const gameScreen = document.getElementById("gameScreen");
  const homeStart  = document.getElementById("homeStart");
  const btnStart   = document.getElementById("btnStart");
  const btnRepeat  = document.getElementById("btnRepeat");
  const gridEl     = document.getElementById("grid");
  const overlay    = document.getElementById("overlay");
  const goodPop    = document.getElementById("goodPop");

  let current = null;
  let locked = false;
  let voiceUnlocked = false;
  let chosenVoice = null;

  // --- å·¥å…·ï¼šæ´—ç‰Œ ---
  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // --- è¯­éŸ³ï¼šé€‰æ›´å¥½çš„è‹±æ–‡ voiceï¼ˆiOS Siri / Enhanced / Premium ä¼˜å…ˆï¼‰---
  function pickBestEnglishVoice() {
    if (!("speechSynthesis" in window)) return null;
    const voices = window.speechSynthesis.getVoices() || [];
    const en = voices.filter(v => /^en(-|_)?/i.test(v.lang));
    const prefer = (re) => en.find(v => re.test((v.name||"") + " " + (v.voiceURI||"")));
    return prefer(/siri/i) || prefer(/premium|enhanced/i) || en.find(v => v.lang === "en-US") || en[0] || null;
  }

  function speakEN(text) {
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.90;
    u.pitch = 1.0;
    if (!chosenVoice) chosenVoice = pickBestEnglishVoice();
    if (chosenVoice) u.voice = chosenVoice;
    window.speechSynthesis.speak(u);
  }

  // --- é¢„åŠ è½½ï¼šä¿®å¤â€œç‚¹å‡»å¼€å§‹åå›¾ç‰‡é—ª 2 ç§’â€ ---
  function preloadAllImages(){
    const urls = BANK.map(x => x.pic);
    return Promise.all(urls.map(url => new Promise(resolve => {
      const img = new Image();
      img.onload = () => resolve(true);
      img.onerror = () => resolve(true); // å³ä½¿å¤±è´¥ä¹Ÿä¸é˜»å¡
      img.src = url;
    })));
  }

  // --- æ— é—ªæ¸²æŸ“ï¼šå…ˆç”Ÿæˆæ–°çš„ DOMï¼Œå›¾ç‰‡ ready åå†ä¸€æ¬¡æ€§æ›¿æ¢ ---
  function renderOptions(options){
    // ä¿æŒé«˜åº¦ï¼Œä¸è¦å…ˆæ¸…ç©ºå¯¼è‡´â€œç©ºç™½â€
    const frag = document.createDocumentFragment();

    options.forEach(item => {
      const btn = document.createElement("button");
      btn.className = "tile";
      btn.setAttribute("aria-label", item.en);

      const img = document.createElement("img");
      img.src = item.pic;
      img.alt = item.en;
      img.decoding = "async";
      img.loading = "eager";

      btn.appendChild(img);
      btn.onclick = () => onPick(item);
      frag.appendChild(btn);
    });

    // ä¸€æ¬¡æ€§æ›¿æ¢ï¼Œé¿å…é—ª
    gridEl.replaceChildren(frag);
  }

  function nextQuestion(){
    locked = false;
    overlay.style.display = "none";

    current = BANK[Math.floor(Math.random() * BANK.length)];
    const others = BANK.filter(x => x.en !== current.en);
    shuffle(others);
    const options = [current, ...others.slice(0, 3)];
    shuffle(options);

    renderOptions(options);

    if (voiceUnlocked) speakEN(current.en);
  }

  function popGood(){
    // å½©çº¸
    [...goodPop.querySelectorAll(".confetti")].forEach(x => x.remove());
    const colors = ["#22c55e","#3b82f6","#f59e0b","#ef4444","#a855f7","#14b8a6"];
    for (let i=0;i<14;i++){
      const s = document.createElement("div");
      s.className = "confetti";
      s.style.background = colors[i % colors.length];
      s.style.left = (50 + (Math.random()*40 - 20)) + "%";
      s.style.bottom = "10px";
      s.style.setProperty("--x0", (Math.random()*120 - 60).toFixed(1) + "px");
      s.style.setProperty("--x1", (Math.random()*240 - 120).toFixed(1) + "px");
      goodPop.appendChild(s);
    }

    overlay.style.display = "flex";
    setTimeout(() => { overlay.style.display = "none"; }, 850);
  }

  function onPick(item){
    if (locked) return;
    locked = true;

    if (item.en === current.en){
      popGood();
      if (voiceUnlocked) speakEN("Good");
      setTimeout(nextQuestion, 900);
    } else {
      // é”™è¯¯ï¼šåªè¯»ä¸€æ¬¡ï¼ˆä¸åŠ æ–‡å­—ï¼‰
      if (voiceUnlocked) speakEN("Try again");
      setTimeout(() => { locked = false; }, 450);
    }
  }

  function enterGame(){
    homeScreen.style.display = "none";
    gameScreen.style.display = "flex";
  }

  async function startFlow(){
    voiceUnlocked = true;
    window.speechSynthesis.getVoices();
    chosenVoice = pickBestEnglishVoice();

    // å…ˆé¢„åŠ è½½å›¾ç‰‡ï¼Œå†è¿›å…¥æ¸¸æˆé¡µ -> æ ¹æ²»é—ªå±
    await preloadAllImages();

    enterGame();
    nextQuestion();
  }

  // å¯åŠ¨é¡µï¼šåªæœ‰ä¸€ä¸ªæŒ‰é’®
  homeStart.addEventListener("click", startFlow);

  // æ¸¸æˆé¡µï¼šä¸¤ä¸ªæŒ‰é’®
  btnStart.addEventListener("click", () => {
    // å¼€å§‹ï¼šåªè¯»å½“å‰é¢˜
    voiceUnlocked = true;
    window.speechSynthesis.getVoices();
    chosenVoice = pickBestEnglishVoice();
    if (current) speakEN(current.en);
    else startFlow();
  });

  btnRepeat.addEventListener("click", () => {
    voiceUnlocked = true;
    window.speechSynthesis.getVoices();
    chosenVoice = pickBestEnglishVoice();
    if (current) speakEN(current.en);
  });

  // voices å¼‚æ­¥åŠ è½½
  if ("speechSynthesis" in window) {
    window.speechSynthesis.onvoiceschanged = () => {
      chosenVoice = pickBestEnglishVoice();
    };
  }

  // ç‚¹é®ç½©å…³é—­ï¼ˆä¸æ˜¾ç¤ºæ–‡å­—ï¼‰
  overlay.addEventListener("click", () => overlay.style.display = "none");
</script>
</body>
</html>
