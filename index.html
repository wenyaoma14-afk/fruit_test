<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>å®å®ç‚¹æ°´æœï¼ˆè‹±æ–‡è¯­éŸ³ï¼‰</title>
  <style>
    :root{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    body{margin:0;background:#f6f7fb;}
    .app{max-width:520px;margin:0 auto;padding:14px;}
    .card{background:#fff;border-radius:18px;padding:16px;box-shadow:0 10px 24px rgba(0,0,0,.08);}
    .top{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
    .title{font-size:18px;font-weight:900;margin:0;}
    .badge{background:#eef2ff;color:#3730a3;padding:6px 10px;border-radius:999px;font-size:13px;}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px;flex-wrap:wrap;}
    .btn{border:0;border-radius:14px;padding:10px 12px;background:#111;color:#fff;font-size:14px;cursor:pointer;}
    .btn:active{transform:scale(.98);}
    .hint{font-size:13px;color:#555;}
    .big{font-size:20px;font-weight:900;}

    .grid{margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .pic{
      border:0;border-radius:18px;padding:16px 12px;background:#fff;
      box-shadow:0 8px 18px rgba(0,0,0,.06);
      cursor:pointer;user-select:none;
      display:flex;align-items:center;justify-content:center;
      min-height:120px;
      transition: transform .06s ease;
      position:relative;
    }
    .pic:active{transform:scale(.98);}
    .emoji{font-size:68px;line-height:1;}
    .pic.correct{outline:4px solid #22c55e;}
    .pic.wrong{outline:4px solid #ef4444;}

    .result{
      margin-top:14px;min-height:130px;border-radius:18px;
      background:#f3f4f6;display:grid;place-items:center;
      position:relative;overflow:hidden;
    }
    .msg{font-size:20px;font-weight:900;text-align:center;}
    .sub{margin-top:6px;font-size:14px;opacity:.75;text-align:center;}

    /* æˆåŠŸï¼šå°å…”å­è·³èˆ */
    .bunnyWrap{
      position:absolute;inset:0;display:none;
      align-items:center;justify-content:center;flex-direction:column;
      gap:8px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(2px);
    }
    .bunny{
      font-size:74px;
      animation: bunnyDance 650ms ease-in-out infinite;
      transform-origin: 50% 80%;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.12));
    }
    @keyframes bunnyDance{
      0%   { transform: translateY(6px) rotate(-8deg) scale(1.0); }
      25%  { transform: translateY(-8px) rotate(8deg) scale(1.06); }
      50%  { transform: translateY(6px) rotate(-8deg) scale(1.0); }
      75%  { transform: translateY(-8px) rotate(8deg) scale(1.06); }
      100% { transform: translateY(6px) rotate(-8deg) scale(1.0); }
    }

    /* å½©çº¸ï¼ˆè½»é‡ï¼‰ */
    .confetti{
      position:absolute;width:12px;height:12px;border-radius:4px;
      opacity:0;animation: fly 900ms ease-out forwards;
    }
    @keyframes fly{
      0%{transform:translate(var(--x0),20px) scale(.6) rotate(0deg);opacity:0;}
      20%{opacity:1;}
      100%{transform:translate(var(--x1),-150px) scale(1.1) rotate(180deg);opacity:0;}
    }

    /* é”™è¯¯æŠ–åŠ¨ */
    .shake{animation:shake 420ms ease-in-out;}
    @keyframes shake{
      0%,100%{transform:translateX(0);}
      25%{transform:translateX(-8px);}
      50%{transform:translateX(8px);}
      75%{transform:translateX(-6px);}
    }

    /* è®©æŒ‰é’®æ›´é€‚åˆå°æœ‹å‹ï¼šæ›´å¤§ä¸€ç‚¹ */
    @media (max-width: 420px){
      .emoji{font-size:72px;}
      .pic{min-height:130px;}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="top">
        <h1 class="title">ç‚¹æ°´æœï¼ˆç³»ç»Ÿè¯»è‹±æ–‡ï¼‰</h1>
        <div class="badge">å¾—åˆ†ï¼š<span id="score">0</span></div>
      </div>

      <div class="row">
        <div>
          <div class="hint">ç³»ç»Ÿä¼šè¯»ï¼šè‹±æ–‡å•è¯ï¼ˆç¬¬ä¸€æ¬¡è¯·ç‚¹â€œå¼€å§‹â€è§£é”è¯­éŸ³ï¼‰</div>
          <div class="big" id="promptText">ç‚¹ã€Œå¼€å§‹ã€åå¬è‹±æ–‡ï¼Œç‚¹å¯¹åº”æ°´æœå›¾ç‰‡</div>
        </div>
        <div style="display:flex; gap:10px;">
          <button class="btn" id="startBtn">å¼€å§‹</button>
          <button class="btn" id="repeatBtn">å†è¯»ä¸€é</button>
          <button class="btn" id="nextBtn">æ¢ä¸€é¢˜</button>
        </div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="result" id="resultBox" aria-live="polite">
        <div style="text-align:center; padding:10px;">
          <div class="msg" id="resultMsg">ğŸ™‚</div>
          <div class="sub" id="resultSub">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
        </div>

        <div class="bunnyWrap" id="bunnyWrap">
          <div class="bunny">ğŸ°</div>
          <div class="msg">æˆåŠŸï¼Good job!</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // âœ… 10ä¸ªå¸¸ç”¨æ°´æœï¼ˆç”¨emojiå½“å›¾ç‰‡ï¼Œåé¢ä½ è¦æ¢çœŸå®å›¾ç‰‡ä¹Ÿå¾ˆå®¹æ˜“ï¼‰
  const BANK = [
    { en:"apple",      pic:"ğŸ" },
    { en:"banana",     pic:"ğŸŒ" },
    { en:"orange",     pic:"ğŸŠ" },
    { en:"grape",      pic:"ğŸ‡" },
    { en:"strawberry", pic:"ğŸ“" },
    { en:"watermelon", pic:"ğŸ‰" },
    { en:"pear",       pic:"ğŸ" },
    { en:"peach",      pic:"ğŸ‘" },
    { en:"mango",      pic:"ğŸ¥­" },
    { en:"pineapple",  pic:"ğŸ" },
  ];

  let score = 0;
  let current = null;
  let locked = false;
  let voiceUnlocked = false;

  const scoreEl = document.getElementById("score");
  const promptTextEl = document.getElementById("promptText");
  const gridEl = document.getElementById("grid");
  const resultBox = document.getElementById("resultBox");
  const resultMsg = document.getElementById("resultMsg");
  const resultSub = document.getElementById("resultSub");
  const bunnyWrap = document.getElementById("bunnyWrap");

  const startBtn = document.getElementById("startBtn");
  const repeatBtn = document.getElementById("repeatBtn");
  const nextBtn = document.getElementById("nextBtn");

  function pickEnglishVoice() {
    const voices = window.speechSynthesis?.getVoices?.() || [];
    if (!voices.length) return null;
    // ä¼˜å…ˆé€‰è‹±æ–‡å¥³å£°/ç¾å›½/è‹±å›½ï¼ˆå°½é‡é€šç”¨ï¼‰
    const prefer = voices.find(v => /en/i.test(v.lang) && /female|woman|siri/i.test(v.name));
    if (prefer) return prefer;
    const enUS = voices.find(v => v.lang === "en-US");
    if (enUS) return enUS;
    const en = voices.find(v => /^en/i.test(v.lang));
    return en || null;
  }

  function speakEN(text) {
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.9;   // æ…¢ä¸€ç‚¹ï¼Œé€‚åˆå­©å­
    u.pitch = 1.05;
    const v = pickEnglishVoice();
    if (v) u.voice = v;
    window.speechSynthesis.speak(u);
  }

  function speakCheer() {
    // è‹±æ–‡é¼“åŠ± + å¯çˆ±ä¸€ç‚¹
    speakEN("Good job!");
  }

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function clearConfetti(){
    [...resultBox.querySelectorAll(".confetti")].forEach(x => x.remove());
  }

  function popConfetti(){
    clearConfetti();
    const colors = ["#22c55e","#3b82f6","#f59e0b","#ef4444","#a855f7","#14b8a6"];
    for (let i=0;i<16;i++){
      const s = document.createElement("div");
      s.className = "confetti";
      s.style.background = colors[i % colors.length];
      s.style.left = (50 + (Math.random()*40 - 20)) + "%";
      s.style.bottom = "10px";
      s.style.setProperty("--x0", (Math.random()*120 - 60).toFixed(1) + "px");
      s.style.setProperty("--x1", (Math.random()*220 - 110).toFixed(1) + "px");
      resultBox.appendChild(s);
    }
  }

  function setNeutral(){
    resultBox.classList.remove("shake");
    clearConfetti();
    bunnyWrap.style.display = "none";
    resultMsg.textContent = "ğŸ™‚";
    resultSub.textContent = "å¬è‹±æ–‡ï¼Œç‚¹å¯¹åº”æ°´æœå›¾ç‰‡ï½";
  }

  function renderQuestion(){
    locked = false;
    setNeutral();

    current = BANK[Math.floor(Math.random() * BANK.length)];
    promptTextEl.textContent = `ç°åœ¨è¯»çš„æ˜¯ï¼š${current.en}ï¼ˆå®å®ä¸ç”¨çœ‹å­—ï¼Œå¬å°±è¡Œï¼‰`;

    // 3ä¸ªå¹²æ‰° + 1ä¸ªæ­£ç¡®
    const others = BANK.filter(x => x.en !== current.en);
    shuffle(others);
    const options = [current, ...others.slice(0, 3)];
    shuffle(options);

    gridEl.innerHTML = "";
    options.forEach(item => {
      const btn = document.createElement("button");
      btn.className = "pic";
      btn.innerHTML = `<div class="emoji" aria-label="${item.en}">${item.pic}</div>`;
      btn.onclick = () => onPick(btn, item);
      gridEl.appendChild(btn);
    });

    // è¯»è‹±æ–‡å•è¯
    if (voiceUnlocked) speakEN(current.en);
  }

  function onPick(btn, item){
    if (locked) return;
    locked = true;

    const buttons = [...document.querySelectorAll(".pic")];
    buttons.forEach(b => b.disabled = true);

    if (item.en === current.en){
      btn.classList.add("correct");
      score += 1;
      scoreEl.textContent = String(score);

      resultMsg.textContent = "ğŸ‰";
      resultSub.textContent = "æˆåŠŸï¼";
      popConfetti();

      bunnyWrap.style.display = "flex";
      if (voiceUnlocked) speakCheer();

      setTimeout(() => renderQuestion(), 1200);
    } else {
      btn.classList.add("wrong");
      resultBox.classList.add("shake");

      // â€œä¼¤å¿ƒå›¾ç‰‡â€ï¼šå…ˆç”¨ğŸ˜¢ï¼ˆä½ è¦æ¢æˆçœŸå®å›¾ç‰‡ä¹Ÿå¯ä»¥ï¼‰
      resultMsg.textContent = "ğŸ˜¢";
      resultSub.textContent = "Try again!";
      if (voiceUnlocked) speakEN("Try again!");

      setTimeout(() => {
        resultBox.classList.remove("shake");
        buttons.forEach(b => { b.disabled = false; b.classList.remove("wrong","correct"); });
        locked = false;
      }, 900);
    }
  }

  // iOSï¼šå¿…é¡»ç”±ç”¨æˆ·æ‰‹åŠ¿è§¦å‘ä¸€æ¬¡ï¼Œæ‰èƒ½æ’­æ”¾è¯­éŸ³
  startBtn.addEventListener("click", () => {
    voiceUnlocked = true;
    // è§¦å‘ä¸€æ¬¡ voices åŠ è½½ï¼ˆæœ‰äº›iOSéœ€è¦ï¼‰
    window.speechSynthesis.getVoices();
    speakEN("Let's start!");
    renderQuestion();
  });

  repeatBtn.addEventListener("click", () => {
    voiceUnlocked = true;
    if (current) speakEN(current.en);
  });

  nextBtn.addEventListener("click", () => renderQuestion());

  // æŸäº›æµè§ˆå™¨ voices å¼‚æ­¥åŠ è½½
  if ("speechSynthesis" in window) {
    window.speechSynthesis.onvoiceschanged = () => {};
  }
</script>
</body>
</html>
